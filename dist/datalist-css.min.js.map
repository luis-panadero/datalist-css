{"version":3,"file":"datalist-css.min.js","sources":["../src/datalist-css.js"],"sourcesContent":["/*\ndatalist-css.js module\n\nload script:\n<script type=\"module\" src=\"./dist/datalist-css.js\"></script>\n\nThen style <datalist> and <option> fields using CSS.\nNote the <datalist> should be placed immediately after its <input>.\n*/\n\n// currently active list\nlet listActive;\n\n/**\n  * Inyects datalist CSS to all <input> elements that have attached an <datalist>\n  * @param {HTMLElement = document} rootElement - HTMLElement where begin to search for the input elements\n  */\nfunction inyectDataListCss(rootElement = document) {\n  // datalist handler events\n  const inputElements = getAllInputsWithDataLists(rootElement);\n  for (const inputElement of inputElements) {\n    inputElement.list.classList.add(\"datalist\");\n    inputElement.addEventListener('focusin', listShowEventHandler);\n  }\n  if (inputElements.length > 0) {\n    document.body.addEventListener('click', closeOnClickOutside);\n    document.addEventListener('keydown', closeOnEscape);\n  }\n}\nexport { inyectDataListCss };\n\n// do not run on the server\nif (typeof document !== \"undefined\") {\n  document.addEventListener(\"DOMContentLoaded\", () => inyectDataListCss());\n}\n\n\n/**\n  * Gets all <input> elements that have attached an <datalist>\n  * @param {HTMLElement} rootElement\n  */\nfunction getAllInputsWithDataLists(rootElement ) {\n  return [...rootElement.querySelectorAll('input[list]:not([list=\"\"]):not([data-datalist-native])')]\n    .filter(inputElement => inputElement.list !== null);\n}\n\n// datalist control focused?\nfunction listShowEventHandler(evt) {\n\n  const input = target(evt);\n  if (!input) {\n    return;\n  }\n\n  if (input.list) {\n\n    // setup of datalist control\n    const dataListElement = input.list;\n    input.datalist = dataListElement;\n    input.removeAttribute('list');\n\n    dataListElement.input = input;\n    dataListElement.setAttribute('tabindex', -1);\n\n    // event handlers\n    input.addEventListener('input', listLimit);\n    input.addEventListener('keydown', listControl);\n    dataListElement.addEventListener('keydown', listKey);\n    dataListElement.addEventListener('click', listSet);\n\n  }\n\n  // show datalist\n  const dataListElement = input.datalist;\n  if (dataListElement && !dataListElement.shown) {\n\n    listHide(listActive);\n\n    dataListElement.shown = true;\n    dataListElement.classList.add(\"datalist--visible\");\n    listLimit(evt);\n    //dataListElement.style.width = input.offsetWidth + 'px';\n    //dataListElement.style.left = input.offsetLeft + 'px';\n    listActive = dataListElement;\n\n  }\n\n}\n\n/**\n  * Hide the datalist\n  * @param dataListElement - DataList HTML element\n  */\nfunction listHide(dataListElement) {\n  if (dataListElement && dataListElement.shown) {\n    dataListElement.classList.remove(\"datalist--visible\");\n    dataListElement.shown = false;\n  }\n}\n\n\n// enable valid and disable invalid options\nfunction listLimit(evt) {\n\n  const input = target(evt);\n  if (!input || !input.datalist) {\n    return;\n  }\n\n  const value = input.value.trim().toLowerCase();\n  const optionElements = [...input.datalist.getElementsByTagName('option')];\n  for (const optionElement of optionElements) {\n    optionElement.setAttribute('tabindex', 0);\n    optionElement.style.display = (!value || optionElement.value.toLowerCase().includes(value)) ? 'block' : 'none';\n  }\n}\n\n\n// key event on input\nfunction listControl(evt) {\n\n  const input = target(evt);\n  if (!input || !input.datalist) {\n    return;\n  }\n\n  switch (evt.keyCode) {\n\n    case 40: {\n      // arrow down\n      let opt = input.datalist.firstElementChild;\n      if (!opt.offsetHeight) opt = visibleSibling(opt, 1);\n      opt && opt.focus();\n      break;\n    }\n\n    case 9:   // tab\n      listHide(input.datalist);\n      break;\n\n    case 13:  // enter\n    case 32:  // space\n      listSet(evt);\n      break;\n\n  }\n\n}\n\n\n// key event on datalist\nconst keymap = {\n  33: -12, // Page Up\n  34: 12, // Page Down\n  38: -1, // Arrow Up\n  40: 1 // Arrow Down\n};\n\nfunction listKey(evt) {\n\n  const targetElement = target(evt);\n  if (!targetElement) {\n    return;\n  }\n\n  const kc = evt.keyCode;\n  const dir = keymap[kc];\n  const dl = targetElement.parentElement;\n\n  if (dir) {\n\n    // move through list\n    let opt = visibleSibling(targetElement, dir);\n    opt && opt.focus();\n    evt.preventDefault();\n\n  } else if (kc === 9 || kc === 13 || kc === 32) {\n\n    // tab, enter, space: use value\n    listSet(evt);\n\n  } else if (kc === 8) {\n\n    // backspace: return to input\n    dl.input.focus();\n\n  } else if (kc === 27) {\n\n    // esc: hide list\n    listHide(dl);\n  }\n}\n\n\n// get previous/next visible sibling\nfunction visibleSibling(opt, dir) {\n\n  let newOpt = opt;\n\n  do {\n\n    if (dir < 0) {\n      newOpt = newOpt.previousElementSibling;\n    } else if (dir > 0) {\n      newOpt = newOpt.nextElementSibling;\n    }\n\n    if (newOpt && newOpt.offsetHeight) {\n      opt = newOpt;\n      dir -= Math.sign(dir);\n    }\n\n  } while (newOpt && dir);\n\n  return opt;\n\n}\n\n\n// set datalist option to input value\nfunction listSet(evt) {\n\n  const t = target(evt);\n  const dataListElement = t && t.parentElement;\n\n  if (!dataListElement || !dataListElement.input) {\n    return;\n  }\n\n  dataListElement.input.value = (t && t.value) || '';\n  listHide(dataListElement);\n}\n\n\n/**\n  * fetch target node\n  * @param t - Event Handler\n  */\nfunction target(t) {\n  return t && t.target;\n}\n\n/**\n * hides the datalist on click outside\n * @param evt - EventHandler\n */\nfunction closeOnClickOutside(evt) {\n  if (!listActive || listActive.contains(evt.target) || evt.target === listActive.input) {\n    return;\n  }\n  listHide(listActive);\n}\n\n/**\n * hides the datalist on hit escape key\n * @param evt - EventHandler\n */\nfunction closeOnEscape(evt) {\n  if (!listActive || !['Esc', 'Escape'].includes(evt.key)) {\n    return;\n  }\n  listHide(listActive);\n}\n\n"],"names":["listActive","inyectDataListCss","rootElement","document","inputElements","querySelectorAll","filter","inputElement","list","getAllInputsWithDataLists","classList","add","addEventListener","listShowEventHandler","length","body","closeOnClickOutside","closeOnEscape","evt","input","target","dataListElement","datalist","removeAttribute","setAttribute","listLimit","listControl","listKey","listSet","shown","listHide","remove","value","trim","toLowerCase","optionElements","getElementsByTagName","optionElement","style","display","includes","keyCode","opt","firstElementChild","offsetHeight","visibleSibling","focus","keymap","targetElement","kc","dir","dl","parentElement","preventDefault","newOpt","previousElementSibling","nextElementSibling","Math","sign","t","contains","key"],"mappings":"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"}