{"version":3,"file":"datalist-css.js","sources":["../src/datalist-css.js"],"sourcesContent":["/*\ndatalist-css.js module\n\nload script:\n<script type=\"module\" src=\"./dist/datalist-css.js\"></script>\n\nThen style <datalist> and <option> fields using CSS.\nNote the <datalist> should be placed immediately after its <input>.\n*/\n\n// currently active list\nlet listActive;\n\n/**\n  * Inyects datalist CSS to all <input> elements that have attached an <datalist>\n  * @param {HTMLElement = document} rootElement - HTMLElement where begin to search for the input elements\n  */\nfunction inyectDataListCss(rootElement = document) {\n  // datalist handler events\n  const inputElements = getAllInputsWithDataLists(rootElement);\n  for (const inputElement of inputElements) {\n    inputElement.list.classList.add(\"datalist\");\n    inputElement.addEventListener('focusin', listShowEventHandler);\n  }\n  if (inputElements.length > 0) {\n    document.body.addEventListener('click', closeOnClickOutside);\n    document.addEventListener('keydown', closeOnEscape);\n  }\n}\nexport { inyectDataListCss };\n\n// do not run on the server\nif (typeof document !== \"undefined\") {\n  document.addEventListener(\"DOMContentLoaded\", () => inyectDataListCss());\n}\n\n\n/**\n  * Gets all <input> elements that have attached an <datalist>\n  * @param {HTMLElement} rootElement\n  */\nfunction getAllInputsWithDataLists(rootElement ) {\n  return [...rootElement.querySelectorAll('input[list]:not([list=\"\"]):not([data-datalist-native])')]\n    .filter(inputElement => inputElement.list !== null);\n}\n\n// datalist control focused?\nfunction listShowEventHandler(evt) {\n\n  const input = target(evt);\n  if (!input) {\n    return;\n  }\n\n  if (input.list) {\n\n    // setup of datalist control\n    const dataListElement = input.list;\n    input.datalist = dataListElement;\n    input.removeAttribute('list');\n\n    dataListElement.input = input;\n    dataListElement.setAttribute('tabindex', -1);\n\n    // event handlers\n    input.addEventListener('input', listLimit);\n    input.addEventListener('keydown', listControl);\n    dataListElement.addEventListener('keydown', listKey);\n    dataListElement.addEventListener('click', listSet);\n\n  }\n\n  // show datalist\n  const dataListElement = input.datalist;\n  if (dataListElement && !dataListElement.shown) {\n\n    listHide(listActive);\n\n    dataListElement.shown = true;\n    dataListElement.classList.add(\"datalist--visible\");\n    listLimit(evt);\n    //dataListElement.style.width = input.offsetWidth + 'px';\n    //dataListElement.style.left = input.offsetLeft + 'px';\n    listActive = dataListElement;\n\n  }\n\n}\n\n/**\n  * Hide the datalist\n  * @param dataListElement - DataList HTML element\n  */\nfunction listHide(dataListElement) {\n  if (dataListElement && dataListElement.shown) {\n    dataListElement.classList.remove(\"datalist--visible\");\n    dataListElement.shown = false;\n  }\n}\n\n\n// enable valid and disable invalid options\nfunction listLimit(evt) {\n\n  const input = target(evt);\n  if (!input || !input.datalist) {\n    return;\n  }\n\n  const value = input.value.trim().toLowerCase();\n  const optionElements = [...input.datalist.getElementsByTagName('option')];\n  for (const optionElement of optionElements) {\n    optionElement.setAttribute('tabindex', 0);\n    optionElement.style.display = (!value || optionElement.value.toLowerCase().includes(value)) ? 'block' : 'none';\n  }\n}\n\n\n// key event on input\nfunction listControl(evt) {\n\n  const input = target(evt);\n  if (!input || !input.datalist) {\n    return;\n  }\n\n  switch (evt.keyCode) {\n\n    case 40: {\n      // arrow down\n      let opt = input.datalist.firstElementChild;\n      if (!opt.offsetHeight) opt = visibleSibling(opt, 1);\n      opt && opt.focus();\n      break;\n    }\n\n    case 9:   // tab\n      listHide(input.datalist);\n      break;\n\n    case 13:  // enter\n    case 32:  // space\n      listSet(evt);\n      break;\n\n  }\n\n}\n\n\n// key event on datalist\nconst keymap = {\n  33: -12, // Page Up\n  34: 12, // Page Down\n  38: -1, // Arrow Up\n  40: 1 // Arrow Down\n};\n\nfunction listKey(evt) {\n\n  const targetElement = target(evt);\n  if (!targetElement) {\n    return;\n  }\n\n  const kc = evt.keyCode;\n  const dir = keymap[kc];\n  const dl = targetElement.parentElement;\n\n  if (dir) {\n\n    // move through list\n    let opt = visibleSibling(targetElement, dir);\n    opt && opt.focus();\n    evt.preventDefault();\n\n  } else if (kc === 9 || kc === 13 || kc === 32) {\n\n    // tab, enter, space: use value\n    listSet(evt);\n\n  } else if (kc === 8) {\n\n    // backspace: return to input\n    dl.input.focus();\n\n  } else if (kc === 27) {\n\n    // esc: hide list\n    listHide(dl);\n  }\n}\n\n\n// get previous/next visible sibling\nfunction visibleSibling(opt, dir) {\n\n  let newOpt = opt;\n\n  do {\n\n    if (dir < 0) {\n      newOpt = newOpt.previousElementSibling;\n    } else if (dir > 0) {\n      newOpt = newOpt.nextElementSibling;\n    }\n\n    if (newOpt && newOpt.offsetHeight) {\n      opt = newOpt;\n      dir -= Math.sign(dir);\n    }\n\n  } while (newOpt && dir);\n\n  return opt;\n\n}\n\n\n// set datalist option to input value\nfunction listSet(evt) {\n\n  const t = target(evt);\n  const dataListElement = t && t.parentElement;\n\n  if (!dataListElement || !dataListElement.input) {\n    return;\n  }\n\n  dataListElement.input.value = (t && t.value) || '';\n  listHide(dataListElement);\n}\n\n\n/**\n  * fetch target node\n  * @param t - Event Handler\n  */\nfunction target(t) {\n  return t && t.target;\n}\n\n/**\n * hides the datalist on click outside\n * @param evt - EventHandler\n */\nfunction closeOnClickOutside(evt) {\n  if (!listActive || listActive.contains(evt.target) || evt.target === listActive.input) {\n    return;\n  }\n  listHide(listActive);\n}\n\n/**\n * hides the datalist on hit escape key\n * @param evt - EventHandler\n */\nfunction closeOnEscape(evt) {\n  if (!listActive || !['Esc', 'Escape'].includes(evt.key)) {\n    return;\n  }\n  listHide(listActive);\n}\n\n"],"names":[],"mappings":"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"}